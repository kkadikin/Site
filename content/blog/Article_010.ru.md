---
title: Сломанная иерархия
date: 2019-12-18
image: images/blog/art_010_foto.jpg
author: Smile
---

> *Рвав-рвав, здесь и сейчас с вами собака Смайл!*
>
> *Для начала немного о том, почему я грустный:* 
>
> *Санкт-Петебрург, середина декабря (!) - дождь, грязюка, холоднюка.*
>
> *Приходится носить всякую фигню. Сопротивление бесполезно. Надеюсь, вы тоже мучаетесь, так как вместе - веселее.*
>
> *Сегодня хотелось бы описать работу с так называемой "сломанной" иерархией данных, когда уровни иерархии / подчинения не структурированы.*


**Пример:**

В качестве исходных данных поступила информация следующего вида: 

-- основной набор, содержащий ID пользователя, номер документа и сумму;

-- справочник, содержащий информацию о структуре подчинения между сотрудниками.

![art_010_screen_1](https://kkadikin.ru/images/blog/art_010_screen_1.jpg)


**Задача:**

На основе представленных данных реализовать следующие требования:

-- построить иерархию данных таким образом, чтобы у каждого сотрудника было одинаковое количество уровней иерархии;

-- убрать повторяющиеся значения на разных уровнях иерархии, то есть, произвести ее "схлопывание".


**Структурирование иерархии:**

**<li>** В целях устранения хаоса в исходных данных для начала нам необходимо понять, является ли конкретное значение конечным элементом иерархии. В этом нам пожет помочь столбец "End Link", в принципе, делать его необязательно, но в случае большого объема данных он сможет помочь при проверке конечного результата:

![art_010_screen_2](https://kkadikin.ru/images/blog/art_010_screen_2.jpg)

```dax
End Link = 
CALCULATE (
    COUNTROWS ( 'Staff Hierarhy' );
    ALL ( 'Staff Hierarhy' );
    'Staff Hierarhy'[Parent Key] = EARLIER ( 'Staff Hierarhy'[User ID] )
) = 0
```

> *Рвав-рвав, до новых встреч!*
>
> *Ваш Смайл*