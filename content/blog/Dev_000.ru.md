---
title: Мониторинг питомцев
date: 2019-12-02
image: images/blog/dev_000_foto.jpg
author: Smile
---

> *Рвав-рвав, с вами социально-ответственный собака Смайл!*
>
> *В связи с прошедшим Днем рождения, а также в рамках постоянной работы над собой, мы рады представить вам свою очередную разработку -- отчет c кодовым названием "Мониторинг питомцев".*
>
> *Отчет построен по данным российской базы чипированных животных, а данные, представленные в отчете -- общего характера.*
>
> *Собака Смайл выражает благодарность коллеге хозяина [Дмитрию Власову](https://dmitriyvlasov.ru) за помощь в создании процедуры парсинга исходных данных.*
>
> *Описание разработки, за исключением процедуры парсинга, представлено ниже.* 

![dev_000_screen](https://kkadikin.ru/images/blog/dev_000_screen.jpg)


**Отчет реализован при помощи DAX и Power Query, при этом:**

**<li>** Источником данных для отчета является "Web" ("Интернет"), то есть web-станицы, соединенные в определенной последовательности, и представленные при помощи функций на уровне Power Query в табличном виде.

**<li>** Географические данные, используемые в отчете, представляют собой "очищенные" позиции, то есть эти данные отличаются от оригинала. Очистка данных производилась большей частью вручную, на уровне DAX, поскольку у человеков просто неисчерпаемая фантазия.

> *Рвав-рвав, отступление из серии "Накипело". Собака Смайл узнал очень много в процессе обработки данных, оказывается, столица нашего государства может писаться следующим образом:*

-- *"MOSKOV" -- тут слов нет, мало того, что английский, так еще и с 2-мя (!) ошибками;*

-- *"ГРАД МОСКОВСКИЙ" -- куда уж нам без пафоса, так и хочется сказать: "Человек, у тебя, вообще-то, друг потерялся...";*

-- *"ТВЕРСКАЯ УЛИЦА" -- таки-да, товарищи, это тоже "МОСКВА" (Смайл понял из контекста), но мы же с вами и так все в курсе, где это... И ничего, что такая же улица, как минимум, в Петербурге есть (рядом с Таврическим садом, если что).*

**<li>** Все показатели расчитаны при помощи мер. 


**Разработка содержит 2 листа:**

**<li>** Лист "Общие данные" -- общая информация о потерянных и найденных питомцах по России и странам мира.

**<li>** Лист "ГЕО - Мир" -- детальная информация по странам мира, за исключением России, с выделением ТОП-5 в рейтинге.

**<li>** Лист "ГЕО - регионы России" -- детальная информация по регионам России, с выделением ТОП-5 в рейтинге.

**<li>** Лист "Породы" -- детальная информация по конкретным породам питомцев, с выделением ТОП-5 в рейтинге.

**<li>** Лист "Подробности" -- персонифицированная информация о конкретном питомце, с указанием номера чипа / клейма для облегчения его идентификации.


**Используемые элементы:**

**<li>** Визуальные фильтры, реализованные при помощи элемента визуализации "Slicer" ("Срез"), а также боковой панели фильтрации.

**<li>** В качестве элементов визуализации используются: "Card" ("Карточка"), "Treemap" ("Диаграмма дерева"), "Donut chart" ("Кольцевой график"), "Map" ("Карта"), "Multi-row card" ("Многострочная карточка"), "Ribbon chart" ("Диаграмма ленты").

**<li>** Иконки.


**Процесс разработки:**

**<li>** Получение данных из веб-источника, и их обработка.

Цитата [разработчика:](https://dmitriyvlasov.ru)

*"...Подготовка данных для отчета осуществляется с помощью Power Query. На входе получаем URL к узловой странице с потерянными или найденными животными. Узловые страницы ведут на по страничное представление списков потерянных или найденных животных в формате "html". На каждой странице содержится одна или несколько таблиц с карточкой животного. С помощью преобразования Power Query и написанного ряда функций Power Query данные загружаются в модель.*

*Ключеые функции:*

*-- Web.Contents -- для загрузки данных;* 

*--List.Accumulate -- для прохождения и обработки в "цикле" каждой страницы и поиска последней заполненной страницы."*

Исходные данные собираются в 2-х таблицах -- "Потерянные питомцы" и "Найденные питомцы".

**<li>** Создана таблица "Субъекты России" -- справочник федеральных округов, субъектов и административных центров России.

**<li>** Создана таблица "Время года" -- справочник по временам года, имеющий ссылку URL на соответствующую иконку.

**<li>** Создана таблица "Статус питомца" -- справочник по состоянию питомца, имеющий ссылку URL на соответствующую иконку.

**<li>** Создана таблица "Меры" -- техническая таблица, созданная для удобства, складываем туда меры (по старинке), хоть теперь можно их группировать при помощи каталогов.

**<li>** Создана таблица "Вид питомца" -- справочник по градации питомцев, имеющий ссылку URL на соответствующую иконку.

**<li>** Создана таблица "Пол питомца" -- справочник, содержащий пол питомца, также имеющий ссылку URL на соответствующую иконку.

На этом работы с Power Query завершены. 

**<li>** Создана таблица "Календарь" -- базовая таблица, определяющая набор дат для расчета, включая сезоны.

**<li>** Создана таблица "Объявления" -- таблица, содержащая консолидированные данные по питомцам, с текущей меткой их статуса.

**<li>** Создана таблица "Геопозиция" -- справочник, содержащий очищенные географические данные, о которых упоминалось выше.

**<li>** Следующим этапом является простановка связей в получившейся модели данных. Схема связей представлена ниже:

![dev_000_relations](https://kkadikin.ru/images/blog/dev_000_relations.jpg)

**<li>** Затем при помощи DAX начинаем формировать нужные аналитические разрезы, например, производим расчет количества случаев потери и нахождения питомцев.

**<li>** Последний шаг разработки -- это дизайн, отчет построен на использовании стандартных элементов.


**Особенности разработки:**

**<li>** В связи с разнообразием в вариациях обозначения географических данных, периодически необходимо дополнять справочник вручную, собака Смайл будет этим по возможности заниматься, как и, собственно, обновлением отчета.

**<li>** Для размещения иконок непосредственно в элементе "Slicer" ("Срез"), изображения должны быть доступны по URL. В данном случае, они размещены в структуре сайта. 

> *Рвав-рвав, с первым снегом всех!*
>
> *Ваш Смайл*


**Разработка была обновлена 9 сентября 2020 года:**

**<li>** Обновлена структура отчета.

**<li>** Обновлен дизайн отчета.

**<li>** Произведена актуализация данных отчета.

**ДЛЯ ЛЮБИТЕЛЕЙ ПОНАЖИМАТЬ НА КНОПОЧКИ**

<iframe width="800" height="600" src="https://app.powerbi.com/view?r=eyJrIjoiYTExMTRmY2QtYTNhMy00ZDk4LWFhODAtMTlmOWUxYzdkZjRlIiwidCI6IjE4YjFiOTZhLTk0MTQtNDE3MC1iNmNhLTZkODU3NTJlNTZmOCIsImMiOjZ9" frameborder="0" allowFullScreen="true"></iframe>