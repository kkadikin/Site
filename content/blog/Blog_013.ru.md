---
title: Собакенские будни - конструкция Userelationship
date: 2021-06-12
image: images/blog/blog_013_foto.jpg
author: Smile
---

> *Рвав-рвав, сегодня я -- собака-вспоминака!*
>
> *Перед вами -- 3-я заметка из нашего цикла "Собакенские будни", и ниже мы рассмотрим использование такой конструкции, как Userelationship. При помощи данной функции можно переопределить активную связь на время выполнение запроса. Синтаксис указанной функции из серии "проще практически не бывает", однако, покопавшись в памяти, собака-вспоминака вспомнил, что встречал в одном сообществе такую вот задачку: "Так и так, хочу в одну таблицу подтянуть столбец из другой таблицы (по принципу работы RELATED), но при этом активную связь надо переопределить, не перестраивая связи в модели…"*
>
> *Ваш покорный слуга не помнит, чем там кончилось дело, как быстро оно заканчивалось, и, более того, в сообществе не поняли, почему оно надо именно так, но, что забавно, решение все-таки есть.*


**Пример:**

**<li>** Таблица "Данные по сотрудникам" содержит необходимые сведения о сотрудниках, а именно, ID сотрудника (например, менеджера по закупкам), некое значение (например, количество заказов), ID ответственного лица (пусть это будет куратор соответствующего менеджера):

![blog_013_screen_1](https://kkadikin.ru/images/blog/blog_013_screen_1.jpg)

**<li>** Таблица "Справочник сотрудников" содержит ID сотрудника, и его фамилию:

![blog_013_screen_2](https://kkadikin.ru/images/blog/blog_013_screen_2.jpg)


**Задача:**

Подтянуть в таблицу "Данные по сотрудникам" фамилии как сотрудников, так и ответственных лиц.

> *Рвав-рвав, конечно, есть много неспортивных способов выполнения поступившего запроса (например, с использованием функции Switch, условного столбца в Power Query и пр.), но поскольку это не интересно и не универсально, мы это, естественно, не рассматриваем.*


**Получение значения "Фамилия сотрудника":**

**<li>** Тут все просто, необходимо настроить нужную связь на уровне модели по полю "ID_Сотрудника":

![blog_013_screen_3](https://kkadikin.ru/images/blog/blog_013_screen_3.jpg)

**<li>** Дальше можно переходить непосредственно к созданию расчетного столбца в таблице "Данные по сотрудникам", используя следующую формулу:

```dax
Фамилия_Cотрудника =
RELATED ( 'Справочник сотрудников'[Фамилия] )
```

**<li>** Затем можно проверить получившийся результат:

![blog_013_screen_4](https://kkadikin.ru/images/blog/blog_013_screen_4.jpg)


**Получение значения "Фамилия ответственного":**

**<li>** Необходимо настроить вторую связь на уровне модели по полю "ID_Ответственного", при этом то, что она будет неактивной -- это нормально:

![blog_013_screen_5](https://kkadikin.ru/images/blog/blog_013_screen_5.jpg)

**<li>** Дальше можно переходить непосредственно к созданию расчетного столбца в таблице "Данные по сотрудникам", используя следующую формулу:

```dax
Фамилия_Ответственного =
CALCULATE (
    MINX ( 'Данные по сотрудникам', RELATED ( 'Справочник сотрудников'[Фамилия] ) ),
    ALL ( 'Справочник сотрудников' ),
    USERELATIONSHIP ( 'Данные по сотрудникам'[ID_Ответственного], 'Справочник сотрудников'[ID_Сотрудника] )
)
```

**<li>** Затем можно проверить получившийся результат:

![blog_013_screen_6](https://kkadikin.ru/images/blog/blog_013_screen_6.jpg)

> *Рвав-рвав, товарищи, намешали, что могли, получили, что хотели…*
>
> *Всем хорошей погоды и горячей воды!*
>
> *Ваш Смайл*