---
title: Аптечка первой помощи
date: 2019-09-06
image: images/blog/dev_004_foto.jpg
author: Smile
---

> *Рвав-рвав, собака Смайл говорит "Здрям!"!*
>
> *Представляем вашему вниманию свою 4-ю разработку комплекта отчетности "Офисная жизнь" -- отчет "Аптечка первой помощи", помогающий контролировать наличие в офисе такой важной вещи, как лекарства.*
>
> **ВАЖНО:**
> *Информация, представленная в отчете, носит демонстрационный характер, и не является руководством к действию, собака Смайл при разработке активно пользовался гуглом.*

![dev_003_screen](https://kkadikin.ru/images/blog/dev_004_screen.jpg)

Отчет реализован при помощи DAX и Power Query, и построен на базе производственного календаря.

> *Не устаю посторять, что "Производственный календарь" -- наше все. Хотя, раскрою секрет, в данном случае он избыточен, и ипользуется просто календарь с датами. Однако собака Смайл -- маленький стратег, и где-то в голове у него стала мелькать идея создать комплект отчетности по принципу "Один файл -- много отчетов".*
> *Так что, зрим глубже, пишем универсально, по возможности -- просто, и единообразно (что, наверно, вы уже заметили по дизайну).*

Опять же, для недавно присоединившихся, описание календаря представлено здесь:
[Производственный календарь](https://kkadikin.ru/ru/blog/development_ru/dev_001/)


**Разработка содержит 2 листа:**

**<li>** Сам отчет.

**<li>** Памятка пользователя.

**Используемые элементы:**

**<li>** Фильтры (стандартный функционал), боковой панелью фильтрации пользоваться не планируем, поскольку при публикации в интернете она становится недоступной;

**<li>** Кнопки;

**<li>** Закладки;

**<li>** Подсказки;

**<li>** В качестве основного элемента используется "Table" ("Таблица"), а дополнительных -- "Card" ("Карточка") и "Donut chart" ("Кольцевая диаграмма");

**<li>** Иконки;

**<li>** Дополнительные украшательства -- "Text box" ("Текстовое поле"), "Shapes" ("Фигуры"), условное форматирование.

**Процесс разработки:**

**<li>** Для указания базового промежутка времени на уровне Power Query были созданы параметры "Start_Date" и "End_Date"  -- это даты начала и окончания периода, которые выведены в заголовок отчета.

**<li>** Создана таблица "Calendar" -- базовая таблица, определяющая набор дат для расчета.

**<li>** Создана таблица "Russian_Holidays" -- таблица настройки, содержащая список российских праздников.

**<li>** Создана таблица "Break_Days" -- таблица настройки, содержащая даты так называемых "перенесенных" дней.

**<li>** Создана таблица "Measure" -- техническая таблица, созданная для удобства, складываем туда меры (по старинке), хоть теперь можно их группировать при  помощи каталогов.

**<li>** Создана таблица "Options" -- содержит параметры отчета для указания необходимого отрезка времени.

**<li>** Создана таблица "Dataset_Plan" -- содержит набор исходных данных, который имеет минимально необходимую структуру для планирования стоимости аптечки, а именно: наименование позиции, которая должна быть в аптечке, плановое количество  указанных позиций (поскольку, их может быть больше одной в зависимости от количества сотрудныков), и плановую цену позиции (ориентировочная цена позиции, так сказать, чтобы представлять бюджет).

**<li>** Создана таблица "Dataset_Actual" -- содержит набор исходных данных, который имеет минимально необходимую структуру для контроля текущего состояния аптечки, а именно: наименование позиции, которая должна быть в аптечке, фактическое количество  указанных позиций, дату проверки аптечки и фактический срок годности конкретной позиции.

**<li>** Создана таблица "First_Aid" -- содержит набор исходных данных, являющийся своеобразным справочником, в котором отражена следующая информация: приоритет позиции, наименование позиции, форму выпуска позиции, справочный срок годности, список симптомов и фармокологическую группу препаратов.

На этом работы с Power Query завершены. 

> *Рав-рвав, видимо, тут стоит пояснить, почему, собственно, так сложно, итак, логика хитрой собаки следующая:
> *--Количество препаратов может быть различно в зависимости от количество сотрудников, работающих в офисе (планирование количества обязательно, так как таблеток может на всех не хватить)*
> *--Срок годности препаратов может быть разным даже при их одинаковом названии. Также есть позиции без срока годности (например, медицинские ножницы), или с большим сроком годности (например, тонометр)*
> *--Также есть очень тонкий момент: препарат может быть в наличии, но при этом просрочен, что, в свою очередь, означает, что по факту его нет. Собака Смайл не рекомендует использовать просроченные лекарства.*
> *--Проверку состояния аптечки лучше делать, например, ежемесячно, то есть, мы предполагаем, что сроки годности вносятся исправно, а просроченные препараты заменяются нормальными на постоянной основе :-)*

**<li>** Следующим этапом является проверка связей получившейся модели данных, и их корректировка в случае необходимости. Схема связей представлена ниже:

![dev_002_relations](https://kkadikin.ru/images/blog/dev_004_relations.jpg)

**<li>** Затем при помощи DAX начинаем формировать нужные аналитические разрезы, например, производим деление общего массива данных, сформированного в таблице "Calculations" на дополнительные составляющие: например, указываем в алгоритме признак того, нужно ли дополнительно приобрести цветы (для девочек!), рассчитываем, нужен ли перенос поздравления в случае, если праздник выпадает на нерабочий день и пр.

**<li>** Далее при помощи мер рассчитывается количество участников поздравления, а также ориентировочный бюджет подарка на человека, в зависимости от его функциональной роли. Конечно, это можно было сделать параметрами, но, поскольку данное значение не меняется часто, при разработке была использована постоянная сумма сбора: 100 руб. на сотрудника, 200 руб. на руководителя, и 300 руб. на ТОП-менеджера.

**<li>** При визуализации данных были использованы иконки условного форматирования, появившиеся в последнем апдейте. 

> *Граждане, Смайл -- в тренде, и даже не поленился, и обновил свой отчет [График работы сотрудников](https://kkadikin.ru/images/blog/dev_002_screen.jpg) в соответствии с последними веяниями.*

**<li>** Предупреждение о празднике высвечивается за неделю, для особо забывчивых.

**<li>** Последний шаг -- это дизайн, тут придерживаемся единого стиля)

**Особенности разработки:**

**<li>** Работа и функционал созданного календаря подробно описана в предыдущей статье, все преимущества сохранены.

**<li>** При разработке сделано допущение, что предупреждать о дне рождения нужно за одну неделю. В принципе, можно лего увеличить, или уменьшить указанных срок.

**<li>** Отчет имеет встроенную систему напоминаний следующего вида:

-- поздравить нужно сегодня;

-- напоминание о юбилее (диапазон пометки взят в промежутке от 15 до 70 лет);

-- напоминание о покупке цветов (делалось для забывчивых мальчиков, если именинник - девочка), однако по запросу можно дополнить данный механизм;

> *Собака Смайл - толерантный, современный пес!*

-- напоминание о переносе поздравления -- в алгоритме учтено, что в случае нерабочего дня, желательно не забыть позравить в первый рабочий день!

**<li>** Дополнительно обозначен размер презента.

**<li>** При разработке отчета данные исходного набора значений вносились непосредственно в Power BI (таблица "Dataset"), дабы конечный файл не зависел от внешних источников. Переключение на внешние источники данных не составляет проблем.

> *Товарищи, данная разработка -- просто мечта, она реально необходима в каждый офис!*
>
> *За сим -- прощаюсь, пойду играть с маленькой хозяйкой, приобрел себе новую игрушку, но, видимо, не совсем себе, а на двоих...*
>
> *Ваш Смайл*

**ДЛЯ ЛЮБИТЕЛЕЙ ПОНАЖИМАТЬ НА КНОПОЧКИ**

<iframe width="800" height="600" src="https://app.powerbi.com/view?r=eyJrIjoiMTdiZjcxZDQtOWExZi00ZDQ3LWEyOTEtNWYyOTQ1MDA2ZjM1IiwidCI6IjE4YjFiOTZhLTk0MTQtNDE3MC1iNmNhLTZkODU3NTJlNTZmOCIsImMiOjZ9" frameborder="0" allowFullScreen="true"></iframe>allowFullScreen="true"></iframe>